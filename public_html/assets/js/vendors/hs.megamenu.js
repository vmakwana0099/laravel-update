/*
 * HS Mega Menu - jQuery Plugin
 * @version: 1.0.0 (Sun, 26 Feb 2017)
 * @requires: jQuery v1.6 or later
 * @author: HtmlStream
 * @event-namespace: .HSMegaMenu
 * @browser-support: IE9+
 * @license:
 *
 * Copyright 2017 HtmlStream
 *
 */ !function(e){"use strict";var t=window.MegaMenu||{};function n(e,t,n,s){var i=this;this.$element=e,this.menu=t,this.options=n,this.$container=s,Object.defineProperties(this,{itemClass:{get:function(){return"mega-menu"===i.options.type?i.options.classMap.hasMegaMenu:i.options.classMap.hasSubMenu}},activeItemClass:{get:function(){return"mega-menu"===i.options.type?i.options.classMap.hasMegaMenuActive:i.options.classMap.hasSubMenuActive}},menuClass:{get:function(){return"mega-menu"===i.options.type?i.options.classMap.megaMenu:i.options.classMap.subMenu}},isOpened:{get:function(){return this.$element.hasClass(this.activeItemClass.slice(1))}}}),this.menu.addClass("animated").on("click.HSMegaMenu",function(e){i._updateMenuBounds()}),this.$element.data("max-width")&&this.menu.css("max-width",this.$element.data("max-width")),this.$element.data("position")&&this.menu.addClass("hs-position-"+this.$element.data("position")),this.options.animationOut&&this.menu.on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(e){i.menu.hasClass(i.options.animationOut)&&(i.$element.removeClass(i.activeItemClass.slice(1)),i.options.afterClose.call(i,i.$element,i.menu)),i.menu.hasClass(i.options.animationIn)&&i.options.afterOpen.call(i,i.$element,i.menu),e.stopPropagation(),e.preventDefault()})}function s(){return"ontouchstart"in window}(t=function(){function t(n,s){var i=this;this.$element=e(n),this.options=e.extend(!0,{},t.defaults,s),this._items=e(),Object.defineProperties(this,{itemsSelector:{get:function(){return i.options.classMap.hasSubMenu+","+i.options.classMap.hasMegaMenu}},_tempChain:{value:null,writable:!0},state:{value:null,writable:!0}}),this.initialize()}return t}()).defaults={event:"hover",direction:"horizontal",breakpoint:991,animationIn:!1,animationOut:!1,rtl:!1,hideTimeOut:300,sideBarRatio:1/4,pageContainer:e("body"),classMap:{initialized:".hs-menu-initialized",mobileState:".hs-mobile-state",subMenu:".hs-sub-menu",hasSubMenu:".hs-has-sub-menu",hasSubMenuActive:".hs-sub-menu-opened",megaMenu:".hs-mega-menu",hasMegaMenu:".hs-has-mega-menu",hasMegaMenuActive:".hs-mega-menu-opened"},mobileSpeed:400,mobileEasing:"linear",beforeOpen:function(){},beforeClose:function(){},afterOpen:function(){},afterClose:function(){}},t.prototype.initialize=function(){var t=this,n=e(window);return this.options.rtl&&this.$element.addClass("hs-rtl"),this.$element.addClass(this.options.classMap.initialized.slice(1)).addClass("hs-menu-"+this.options.direction),n.on("resize.HSMegaMenu",function(e){t.resizeTimeOutId&&clearTimeout(t.resizeTimeOutId),t.resizeTimeOutId=setTimeout(function(){window.innerWidth<=t.options.breakpoint&&"desktop"==t.state?t.initMobileBehavior():window.innerWidth>t.options.breakpoint&&"mobile"==t.state&&t.initDesktopBehavior(),t.refresh()},50)}),e(document).on("click.HSMegaMenu touchstart.HSMegaMenu","body",function(n){var s=e(n.target).parents(t.itemsSelector);t.closeAll(s.add(e(n.target)))}),n.on("keyup.HSMegaMenu",function(e){e.keyCode&&27===e.keyCode&&(t.closeAll(),isMenuOpened=!1)}),window.innerWidth<=this.options.breakpoint?this.initMobileBehavior():window.innerWidth>this.options.breakpoint&&this.initDesktopBehavior(),this.smartPositions(),this},t.prototype.smartPositions=function(){var t=this;this.$element.find(this.options.classMap.subMenu).each(function(s,i){n.smartPosition(e(i),t.options)})},t.prototype.bindEvents=function(){var t=this;"hover"!==this.options.event||s()?(this.$element.on("click.HSMegaMenu",s()?this.options.classMap.hasMegaMenu+" > a, "+this.options.classMap.hasSubMenu+" > a":this.options.classMap.hasMegaMenu+':not([data-event="hover"]) > a,'+this.options.classMap.hasSubMenu+':not([data-event="hover"]) > a',function(n){var s,i=e(this).parent();i.parents(t.itemsSelector),i.data("HSMenuItem")||t.initMenuItem(i,t.getType(i)),t.closeAll(i.add(i.parents(t.itemsSelector))),(s=i.addClass("hs-event-prevented").data("HSMenuItem")).isOpened?s.desktopHide():s.desktopShow(),n.preventDefault(),n.stopPropagation()}),s()||this.$element.on("mouseenter.HSMegaMenu",this.options.classMap.hasMegaMenu+'[data-event="hover"],'+this.options.classMap.hasSubMenu+'[data-event="hover"]',function(n){var s=e(this),i=s.parents(t.itemsSelector);s.data("HSMenuItem")||t.initMenuItem(s,t.getType(s)),t.closeAll(s.add(i)),i.add(s).each(function(t,n){var s=e(n).data("HSMenuItem");s.hideTimeOutId&&clearTimeout(s.hideTimeOutId),s.desktopShow()}),n.preventDefault(),n.stopPropagation()}).on("mouseleave.HSMegaMenu",this.options.classMap.hasMegaMenu+'[data-event="hover"],'+this.options.classMap.hasSubMenu+'[data-event="hover"]',function(n){e(this).data("HSMenuItem").hideTimeOutId=setTimeout(function(){t.closeAll(e(n.relatedTarget).parents(t.itemsSelector))},t.options.hideTimeOut),n.preventDefault(),n.stopPropagation()})):this.$element.on("mouseenter.HSMegaMenu",this.options.classMap.hasMegaMenu+':not([data-event="click"]),'+this.options.classMap.hasSubMenu+':not([data-event="click"])',function(n){var s=e(this),i=s.parents(t.itemsSelector);s.data("HSMenuItem")||t.initMenuItem(s,t.getType(s)),i=i.add(s),t.closeAll(i),i.each(function(t,n){var s=e(n).data("HSMenuItem");s.hideTimeOutId&&clearTimeout(s.hideTimeOutId),s.desktopShow()}),t._items=t._items.not(i),t._tempChain=i,n.preventDefault(),n.stopPropagation()}).on("mouseleave.HSMegaMenu",this.options.classMap.hasMegaMenu+':not([data-event="click"]),'+this.options.classMap.hasSubMenu+':not([data-event="click"])',function(n){var s=e(this).data("HSMenuItem"),i=e(n.relatedTarget).parents(t.itemsSelector);s.hideTimeOutId=setTimeout(function(){t.closeAll(i)},t.options.hideTimeOut),t._items=t._items.add(t._tempChain),t._tempChain=null,n.preventDefault(),n.stopPropagation()}).on("click.HSMegaMenu",this.options.classMap.hasMegaMenu+'[data-event="click"] > a, '+this.options.classMap.hasSubMenu+'[data-event="click"] > a',function(n){var s,i=e(this).parent('[data-event="click"]');i.data("HSMenuItem")||t.initMenuItem(i,t.getType(i)),t.closeAll(i.add(i.parents(t.itemsSelector))),(s=i.data("HSMenuItem")).isOpened?s.desktopHide():s.desktopShow(),n.preventDefault(),n.stopPropagation()}),this.$element.on("keydown.HSMegaMenu",this.options.classMap.hasMegaMenu+" > a,"+this.options.classMap.hasSubMenu+" > a",function(n){var s,i=e(this),a=i.parent();a.data("HSMenuItem")||t.initMenuItem(a,t.getType(a)),s=a.data("HSMenuItem"),i.is(":focus")&&(n.keyCode&&40===n.keyCode&&(n.preventDefault(),s.desktopShow(),isMenuOpened=!0),n.keyCode&&13===n.keyCode&&(!0===isMenuOpened?(s.desktopHide(),isMenuOpened=!1):(s.desktopShow(),isMenuOpened=!0))),i.on("focusout",function(){isMenuOpened=!1}),s.menu.find("a").on("focusout",function(){setTimeout(function(){s.menu.find("a").is(":focus")||(s.desktopHide(),isMenuOpened=!1)})})})},t.prototype.initMenuItem=function(t,s){var i=new n(t,t.children(this.options.classMap["mega-menu"===s?"megaMenu":"subMenu"]),e.extend(!0,{type:s},this.options,t.data()),this.$element);t.data("HSMenuItem",i),this._items=this._items.add(t)},t.prototype.initMobileBehavior=function(){var t=this;this.state="mobile",this.$element.off(".HSMegaMenu").addClass(this.options.classMap.mobileState.slice(1)).on("click.HSMegaMenu",t.options.classMap.hasSubMenu+" > a, "+t.options.classMap.hasMegaMenu+" > a",function(n){var s,i=e(this).parent();i.data("HSMenuItem")||t.initMenuItem(i,t.getType(i)),t.closeAll(i.parents(t.itemsSelector).add(i)),(s=i.data("HSMenuItem")).isOpened?s.mobileHide():s.mobileShow(),n.preventDefault(),n.stopPropagation()}).find(this.itemsSelector).not(this.options.classMap.hasSubMenuActive+","+this.options.classMap.hasMegaMenuActive).children(this.options.classMap.subMenu+","+this.options.classMap.megaMenu).hide()},t.prototype.initDesktopBehavior=function(){this.state="desktop",this.$element.removeClass(this.options.classMap.mobileState.slice(1)).off(".HSMegaMenu").find(this.itemsSelector).not(this.options.classMap.hasSubMenuActive+","+this.options.classMap.hasMegaMenuActive).children(this.options.classMap.subMenu+","+this.options.classMap.megaMenu).hide(),this.bindEvents()},t.prototype.closeAll=function(t){var n=this;return this._items.not(t&&t.length?t:e()).each(function(t,s){e(s).removeClass("hs-event-prevented").data("HSMenuItem")["mobile"===n.state?"mobileHide":"desktopHide"]()})},t.prototype.getType=function(e){return e&&e.length?e.hasClass(this.options.classMap.hasSubMenu.slice(1))?"sub-menu":e.hasClass(this.options.classMap.hasMegaMenu.slice(1))?"mega-menu":null:null},t.prototype.getState=function(){return this.state},t.prototype.refresh=function(){return this._items.add(this._tempChain).each(function(t,n){e(n).data("HSMenuItem")._updateMenuBounds()})},n.prototype.desktopShow=function(){return this.menu.length&&(this.$element.addClass(this.activeItemClass.slice(1)),this._updateMenuBounds(),this.menu.show(),"horizontal"==this.options.direction&&this.smartPosition(this.menu,this.options),this.options.animationOut?this.menu.removeClass(this.options.animationOut):this.options.afterOpen.call(this,this.$element,this.menu),this.options.animationIn&&this.menu.addClass(this.options.animationIn)),this},n.prototype.desktopHide=function(){return this.menu.length&&(this.$element.removeClass(this.activeItemClass.slice(1)),this.menu.hide(),this.options.animationIn&&this.menu.removeClass(this.options.animationIn),this.options.animationOut?this.menu.addClass(this.options.animationOut):this.options.afterClose.call(this,this.$element,this.menu)),this},n.prototype.mobileShow=function(){var e=this;return this.menu.length&&(this.menu.removeClass(this.options.animationIn).removeClass(this.options.animationOut).stop().slideDown({duration:e.options.mobileSpeed,easing:e.options.mobileEasing,complete:function(){e.options.afterOpen.call(e,e.$element,e.menu)}}),this.$element.addClass(this.activeItemClass.slice(1))),this},n.prototype.mobileHide=function(){var e=this;return this.menu.length&&(this.menu.stop().slideUp({duration:e.options.mobileSpeed,easing:e.options.mobileEasing,complete:function(){e.options.afterClose.call(e,e.$element,e.menu)}}),this.$element.removeClass(this.activeItemClass.slice(1))),this},n.prototype.smartPosition=function(e,t){n.smartPosition(e,t)},n.smartPosition=function(t,n){(t||t.length)&&(e(window),t.removeClass("hs-reversed"),n.rtl?t.offset().left<0&&t.addClass("hs-reversed"):t.offset().left+t.outerWidth()>window.innerWidth&&t.addClass("hs-reversed"))},n.prototype._updateMenuBounds=function(){var t="auto";if("vertical"==this.options.direction&&"mega-menu"==this.options.type){if(this.$container&&"desktop"==this.$container.data("HSMegaMenu").getState()?(this.options.pageContainer.length||(this.options.pageContainer=e("body")),t=this.options.pageContainer.outerWidth()*(1-this.options.sideBarRatio)):t="auto",this.menu.css({width:t,height:"auto"}),this.menu.outerHeight()>this.$container.outerHeight())return;this.menu.css("height","100%")}},e.fn.HSMegaMenu=function(){var e,n,s=this,i=arguments[0],a=Array.prototype.slice.call(arguments,1),o=s.length;for(e=0;e<o;e++)if("object"==typeof i||void 0===i?s[e].MegaMenu=new t(s[e],i):n=s[e].MegaMenu[i].apply(s[e].MegaMenu,a),void 0!==n)return n;return s}}(jQuery);